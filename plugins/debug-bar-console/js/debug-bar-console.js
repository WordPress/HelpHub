(function(d){var c={},b={},e,f,a;e=function(){var g=f.inputs[f.mode];if(!g){return}if(f.editors[f.mode]){f.editors[f.mode].save()}d.post(ajaxurl,{action:"debug_bar_console",mode:f.mode,data:g.val(),nonce:a},function(h){b.body.html(h)});return false};f={mode:"php",tabs:{},inputs:{},change:function(g){if(g==f.mode){return}if(f.tabs[f.mode]){f.tabs[f.mode].removeClass("debug-bar-console-tab-active")}c.form.removeClass("debug-bar-console-mode-"+f.mode);c.form.addClass("debug-bar-console-mode-"+g);f.mode=g;if(f.tabs[f.mode]){f.tabs[f.mode].addClass("debug-bar-console-tab-active")}f.maybeInitEditor()},editors:{},codemirror:{modes:{php:"application/x-httpd-php",sql:"text/x-mysql"},defaults:{lineNumbers:true,lineWrapping:true,matchBrackets:true,indentUnit:4,indentWithTabs:true,enterMode:"keep",onKeyEvent:function(g,h){if(h.keyCode==13&&h.shiftKey){h.stop();e();return true}}}},maybeInitEditor:function(){var g,h;if(!f.codemirror.modes[f.mode]||!f.inputs[f.mode]){return}if(!f.editors[f.mode]){g=d.extend({},f.codemirror.defaults,{mode:f.codemirror.modes[f.mode]});f.editors[f.mode]=CodeMirror.fromTextArea(f.inputs[f.mode][0],g);c.form.show()}h=f.editors[f.mode];h.focus();h.setCursor(h.lineCount())}};d(document).ready(function(){d.extend(c,{form:d("#debug-bar-console"),submit:d("#debug-bar-console-submit a"),output:d("#debug-bar-console-output")});c.wrap=c.form.parent();a=d("#_wpnonce_debug_bar_console").val();b.css=d("#debug-bar-console-iframe-css").val();b.container=d("iframe",c.output);b.contents=b.container.contents();b.document=b.contents[0];b.body=d(b.document.body);d("head",b.contents).append('<link type="text/css" href="'+b.css+'" rel="stylesheet" />');c.submit.click(e);c.wrap.bind("debug-bar-show",function(){f.maybeInitEditor()});d(".debug-bar-console-tab").each(function(){var i=d(this),h=i.find("input").val(),g;if(h){f.tabs[h]=i;i.data("console-tab",h);g=d("#debug-bar-console-input-"+h);if(g.length){f.inputs[h]=g}}}).click(function(){f.change(d(this).data("console-tab"))})})})(jQuery);